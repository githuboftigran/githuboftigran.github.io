<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS</title>
</head>
<body style="background-color: #444; padding: 30px;">
    <div style="display: flex;">
        <canvas id="mainDrawingCanvas" width="800" height="800"></canvas>
        <div style="display: flex; flex-direction: column; flex: 1; margin-left: 30px;">
            <div style="display: flex; align-items: center; margin-bottom: 40px">
                <div style="display: flex; flex-direction: column; flex: 1;">
                    <span style="color: #fff;  margin-bottom: 10px;">Corners</span>
                    <span style="color: #fff" id="cornersValue">6</span>
                </div>
                <div style="display: flex; flex: 6; flex-direction: column">
                    <div style="display: flex; justify-content: space-between">
                        <span style="color: #fff; margin-right: 8px;">3</span>
                        <span style="color: #fff; margin-right: 8px;">17</span>
                    </div>
                    <input type="range" min="3" max="17" value="6" id="cornersInput">
                </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 40px">
                <div style="display: flex; flex-direction: column; flex: 1">
                    <span style="color: #fff;  margin-bottom: 10px;">Line width</span>
                    <span style="color: #fff" id="lineWidthValue">4</span>
                </div>
                <div style="display: flex; flex: 6; flex-direction: column">
                    <div style="display: flex; justify-content: space-between">
                        <span style="color: #fff; margin-right: 8px;">1</span>
                        <span style="color: #fff; margin-right: 8px;">20</span>
                    </div>
                    <input type="range" min="1" max="20" value="4" id="lineWidthInput">
                </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 40px">
                <div style="display: flex; flex-direction: column; flex: 1">
                    <span style="color: #fff;  margin-bottom: 10px;">Angle</span>
                    <span style="color: #fff" id="angleValue">0.8</span>
                </div>
                <div style="display: flex; flex: 6; flex-direction: column">
                    <div style="display: flex; justify-content: space-between">
                        <span style="color: #fff; margin-right: 8px;">1</span>
                        <span style="color: #fff; margin-right: 8px;">360</span>
                    </div>
                    <input type="range" min="0.1" max="30" value="0.8" step="0.1" id="angleInput">
                </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 40px">
                <div style="display: flex; flex-direction: column; flex: 1">
                    <span style="color: #fff;  margin-bottom: 10px;">Fraction</span>
                    <span style="color: #fff" id="fractionValue">0.9955</span>
                </div>
                <div style="display: flex; flex: 6; flex-direction: column">
                    <div style="display: flex; justify-content: space-between">
                        <span style="color: #fff; margin-right: 8px;">0.90</span>
                        <span style="color: #fff; margin-right: 8px;">0.999</span>
                    </div>
                    <input type="range" min="0.90" max="0.999" value="0.9955" step="0.0005" id="fractionInput">
                </div>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 40px">
                <div style="display: flex; flex-direction: column; flex: 1">
                    <span style="color: #fff;  margin-bottom: 10px;">Count</span>
                    <span style="color: #fff" id="countValue">100</span>
                </div>
                <div style="display: flex; flex: 6; flex-direction: column">
                    <div style="display: flex; justify-content: space-between">
                        <span style="color: #fff; margin-right: 8px;">1</span>
                        <span style="color: #fff; margin-right: 8px;">1000</span>
                    </div>
                    <input type="range" min="1" max="1000" value="100" id="countInput">
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    const ANGLE = 24;
    const FRACTION = 0.98;
    const COUNT = 25;
    const SIZE = 120;

    //const COLORS = [0xff0000, 0xff7f00, 0xffff00, 0x00ff00, 0x00ff00, 0x99ccff, 0x99ccff, 0x0000ff, 0x0000ff, 0x0000ff, 0xcc00ff, 0xcc00ff, 0xcc00ff, 0xcc00ff, 0xcc00ff, 0xcc00ff, ];
    //const COLORS = [0x00afff, 0x0000ff, 0xff0000, 0xff0000];
    //const COLORS = [0xff0000, 0x0000ff, 0x00ffff];
    //const COLORS = [0x0000ff, 0xff0000];
    //const COLORS = [0x4444ff, 0xff4444];
    //const COLORS = [0x6600ff, 0x0000ff];
    const COLORS = [0x0066ff, 0x00ffff];

    const SQ32 = Math.sqrt(3) / 2;

    const interpolateColor = (colors, position) => {
        const scaledPosition = position * (colors.length - 1);
        const startColor = colors[Math.floor(scaledPosition)];
        const endColor = colors[Math.ceil(scaledPosition)];
        const fraction = scaledPosition - Math.floor(scaledPosition);
        const sRed = (startColor >>> 16) & 0xff;
        const sGreen = (startColor >>> 8) & 0xff;
        const sBlue = startColor & 0xff;

        const eRed = (endColor >>> 16) & 0xff;
        const eGreen = (endColor >>> 8) & 0xff;
        const eBlue = endColor & 0xff;

        const rRed = Math.round(sRed + (eRed - sRed) * fraction);
        const rGreen = Math.round(sGreen + (eGreen - sGreen) * fraction);
        const rBlue = Math.round(sBlue + (eBlue - sBlue) * fraction);

        return (rRed << 16) | (rGreen << 8) | rBlue;
    };

    const drawPolygon = (size, center, corners, color, context) => {
        const {cx, cy} = center;
        context.beginPath();
        context.strokeStyle = color;
        context.moveTo(cx + size, cy);
        for(let i = 0; i < corners; i+=1) {
            const angle = i * 2 * Math.PI / corners;
            const dx = Math.cos(angle) * size;
            const dy = Math.sin(angle) * size;
            context.lineTo(cx + dx, cy + dy);
        }
        context.closePath();
        context.stroke();
    };

    const drawPattern = (center, size, corners, lineWidth, count, angle, fraction, context) => {
        context.save();
        context.lineWidth = lineWidth;
        const {cx, cy} = center;
        for(let i = 0; i < count; i += 1) {
            const alpha = Math.floor(255 - 255 * i / count);

            const color = interpolateColor(COLORS, i / count);
            const colorStr = color.toString(16);
            let colorWithAlpha = `${colorStr}${alpha < 16 ? '0' : ''}${alpha.toString(16)}`;
            if (colorWithAlpha.length < 8) {
                colorWithAlpha = '0'.repeat(8 - colorWithAlpha.length) + colorWithAlpha;
            }
            drawPolygon(size, center, corners, `#${colorWithAlpha}`, context);
            context.translate(cx, cy);
            context.rotate(angle * Math.PI / 180);
            context.translate(-cx, -cy);
            size *= fraction;
        }
        context.restore();
    };

    window.onload = function() {
        const canvas = document.getElementById('mainDrawingCanvas');
        const cornersInput = document.getElementById('cornersInput');
        const cornersValue = document.getElementById('cornersValue');
        const lineWidthInput = document.getElementById('lineWidthInput');
        const lineWidthValue = document.getElementById('lineWidthValue');
        const angleInput = document.getElementById('angleInput');
        const angleValue = document.getElementById('angleValue');
        const fractionInput = document.getElementById('fractionInput');
        const fractionValue = document.getElementById('fractionValue');
        const countInput = document.getElementById('countInput');
        const countValue = document.getElementById('countValue');

        const context = canvas.getContext('2d');
        const { width, height } = canvas;

        let corners = cornersInput.value;
        let lineWidth = lineWidthInput.value;
        let angle = angleInput.value;
        let fraction = fractionInput.value;
        let count = countInput.value;

        const redraw = () => {
            context.fillStyle = 'black';
            context.fillRect(0, 0, width, height);

            const center = { cx: width / 2, cy: height / 2 };
            drawPattern(center, 350, corners, lineWidth, count, angle, fraction, context);
        };

        cornersInput.addEventListener('input', ({ target }) => {
            cornersValue.textContent = target.value;
            corners = target.value;
            redraw();
        });

        lineWidthInput.addEventListener('input', ({ target }) => {
            lineWidthValue.textContent = target.value;
            lineWidth = target.value;
            redraw();
        });

        angleInput.addEventListener('input', ({ target }) => {
            angleValue.textContent = target.value;
            angle = target.value;
            redraw();
        });

        fractionInput.addEventListener('input', ({ target }) => {
            fractionValue.textContent = target.value;
            fraction = target.value;
            redraw();
        });

        countInput.addEventListener('input', ({ target }) => {
            countValue.textContent = target.value;
            count = target.value;
            redraw();
        });

        redraw();
    };
</script>
</html>
